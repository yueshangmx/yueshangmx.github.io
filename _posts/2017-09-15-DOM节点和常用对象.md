---
layout: post
title: 16.DOM节点和常用对象
date: 2017-09-15
description: "DOM操作，DOM对象"
tags: 笔记   
---

### 1.DOM节点的创建和删除
1.创建节点：主要考虑元素节点
```
1）创建空元素对象：
  var newElem=document.createElement("标签名");
    比如：var a=document.create.Element("a");
2）设置必要属性：
  newElem.属性名="值";
  newElem.innerHTML="文本";
    比如：a.href="https://www.baidu.com";
          a.innerHTML="百度一下";
3）将元素挂载到指定父元素下：2种
  追加：parent.appendChild(newElem);
  parent.insertBefore(newElem,existElem);
```
2.文档片段：documentfragment

文档片段就是内存中，临时存储多个子节点的存储空间

为html页面反复追加多个平级元素时，每次追加都会更新一次页面，将所有需要追加的元素先追加到文档片段中，将文档片段一次性追加到父元素下，可提高页面性能。而文档片段本身不参与追加。

例：使用DOM节点操作动态创建表格
```
<!DOCTYPE HTML>
<html>
<head>
  <title>动态创建表格</title>
  <meta charset="utf-8"/>
  <style>
    table {
      width: 600px;
      border-collapse: collapse;
      text-align: center;
    }
    td, th {
      border: 1px solid #ccc
    }
  </style>
  <script>
    //假如从服务器收到json字符串如下
    var json = '[{"ename":"Tom","salary":5000,"age":25},{"ename":"John","salary":7000,"age":28},{"ename":"Marry","salary":6000,"age":27}]';
    var emps = eval(json);
    console.log(emps);
    //页面加载后，在data div中创建table对象及子对象
    window.onload = function () {
      //step1：创建空table对象
      /*var table=document.createElement("table");
      //step2：添加表头行
        //step2.1：创建空的tr对象，临时保存在tr中
      var tr=document.createElement("tr");
        //step2.2：创建3个空的td对象
      var th1=document.createElement("th");
      var th2=document.createElement("th");
      var th3=document.createElement("th");
        //	第一个td对象的内容是姓名，第二个是薪资，第三个是年龄
      th1.innerHTML="姓名";
      th2.innerHTML="薪资";
      th3.innerHTML="年龄";
        //step2.3：将三个td分别追加到tr对象下
      tr.appendChild(th1);
      tr.appendChild(th2);
      tr.appendChild(th3);
        //step2.4：将tr追加到table对象下
      table.appendChild(tr);
      */
      //step3：遍历emps数组中每个对象
      //	每遍历一个对象，要创建一个空tr对象
      //	创建一个空td对象，放入当前对象的ename属性值
      //	创建一个空td对象，放入当前对象的salary属性值
      //	创建一个空td对象，放入当前对象的age属性值
      //	将三个td都追加到tr下
      //	将tr追加到table下
      var table = document.querySelector("#data table")
      var frag = document.createDocumentFragment();
      for (var i = 0; i < emps.length; i++) {
        var tr = document.createElement("tr");
        var tdname = document.createElement("td");
        tdname.innerHTML = emps[i].ename;
        var tdsalary = document.createElement("td");
        tdsalary.innerHTML = "&yen;" + emps[i].salary.toFixed(2);
        var tdage = document.createElement("td");
        tdage.innerHTML = emps[i].age;
        tr.appendChild(tdname);
        tr.appendChild(tdsalary);
        tr.appendChild(tdage);
        frag.appendChild(tr);
      }
      table.appendChild(frag);
      //最后一步：找到data div，将table追加到data下
      document.querySelector("#data").appendChild(table);
    }
  </script>
</head>
<body>
<div id="data">
  <table>
    <tr>
      <th>姓名</th>
      <th>薪资</th>
      <th>年龄</th>
    </tr>
  </table>
</div>
</body>
</html>
```

3.创建删除节点
```
插入新元素：parent.insertBefore(newElem,existElem);
删除节点：parent.removeChild(oldElem);==>oldElem.parentNode.removeChild(oldElem)
替换节点：parent.replaceChild(newElem,oldChild);
```

例：二级联动下拉列表
```
<!DOCTYPE HTML>
<html>
<head>
  <title>二级联动列表</title>
  <meta charset="utf-8"/>
  <style>
    .hide {
      display: none;
    }
  </style>
  <script>
    /*实现“省”和“市”的级联下拉列表*/
    var cities = [[], /*0号下标没有元素*/
      [{"name": '东城区', "value": 101},
        {"name": '西城区', "value": 102},
        {"name": '海淀区', "value": 103},
        {"name": '朝阳区', "value": 104}],
      [{"name": '河东区', "value": 201},
        {"name": '河西区', "value": 202},
        {"name": '南开区', "value": 303}],
      [{"name": '石家庄市', "value": 301},
        {"name": '廊坊市', "value": 302},
        {"name": '保定市', "value": 303},
        {"name": '唐山市', "value": 304},
        {"name": '秦皇岛市', "value": 304}]
    ];
    function loadCities(i) {
      var selCities = document.querySelector("select[name='cities']");
      if (cities[i].length == 0) {
        //将cities select元素className设置为hide
        selCities.className = "hide";
      }
      else {//获得的城市数组追加到cities select中
        //清空cities select中所有字节点
        selCities.innerHTML = "";
        //创建一个文档片段
        var frag = document.createDocumentFragment();
        //遍历数组中每个城市名
        //	每遍历一个就创建一个option对象
        //	设置option对象的内容为城市，value为城市的value
        //	将option追加到文档片段中
        //（遍历结束后），将文档片段追加到cities select中，将cities select的class属性清除
        for (var n = 0; n < cities[i].length; n++) {
          var opt = document.createElement("option");
          opt.innerHTML = cities[i][n].name;
          opt.value = cities[i][n].value;
          frag.appendChild(opt);
        }
        selCities.appendChild(frag);
        selCities.removeAttribute('class');
      }
    }
  </script>
</head>
<body>
<select name="provs" onchange="loadCities(this.selectedIndex)">
  <option>—请选择—</option>
  <option>北京市</option>
  <option>天津市</option>
  <option>河北省</option>
</select>
<select name="cities" class="hide" onchange="show(this.selectedIndex)"></select>
</body>
</html>
```

### 2.常用DOM对象