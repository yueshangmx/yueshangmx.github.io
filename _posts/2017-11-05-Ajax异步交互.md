---
layout: post
title: 23.Ajax异步交互
date: 2017-11-05
description: "Ajax，异步交互"
tags: 笔记   
---

### 1.基本内容
#### 1.同步交互与异步交互

`同步交互`：客户端向服务器端发送请求,到服务器端进行响应,这个过程中,用户是不能做任何其他事情(等)。

`异步交互`：客户端向服务器端发送请求，直到服务器端进行响应，这个过程中，用户可以做任何其他事情(不等)。

#### 2.Ajax

ajax 全称是Asynchronous JavaScript and Xml。

直译中文 - javascript和XML的异步

(不严格的定义)客户端与服务器端进行交互,而无需刷新当前页面的技术,称之为`Ajax`。

Ajax实现的是B/S架构下的异步交互


#### 3.同步与异步的区别
```
同步交互
    * 执行速度相对比较慢
    * 响应的是完整的HTML页面
异步交互
    * 执行速度相对比较快
    * 响应的是部分数据
```

### 2.Ajax核心对象

#### 1.XMLHttpRequest对象
```
function getXhr(){  // 声明XMLHttpRequest对象
  var xhr=null;
  if(window.XMLHttpRequest){    // 根据浏览器的不同情况进行创建
    xhr=new XMLHttpRequest();   // 表示除IE外的其他浏览器
  }else{
    xhr=new ActiveXObject('Microsoft.XMLHttp');  // 表示IE浏览器
  }
  return xhr;
}
//创建核心对象
var xhr = getXhr();
```

#### 2.属性

`readyState` - 获取客户端与服务器的通信状态

`status` - 获取服务器端返回的状态码

#### 3.方法

open() - 与服务器端建立连接

send() - 向服务器端发送请求

#### 4.事件

onreadystatechange事件 - 监听服务器端的通信状态改变

#### 5.实现Ajax异步交互的步骤
```
(1)创建XMLHttpRequest核心对象 - 固定写法
(2)与服务器端建立连接
    * 使用XMLHttpRequest对象的open(method,url)方法
        * method - 设置当前请求的类型(get,post)
        * url - 设置当前请求的地址
(3)向服务器端发送请求
    * 使用XMLHttpRequest对象的send(请求参数)方法
        * 请求参数的格式 - key=value
(4)接收服务器端的响应数据
    * 使用XMLHttpRequest对象的onreadystatechange事件,监听服务器端的通信状态
    * 使用XMLHttpRequest对象的readyState属性,判断服务器端的当前状态(0-4)
    * 使用XMLHttpRequest对象的status属性,判断服务器端的状态码(200)
    * 使用XMLHttpRequest对象的responseText属性,接收服务器端的响应数据
```

Ajax异步交互中使用get和post的区别
```
GET请求类型
    * send()方法不起作用,但是不能被省略
       xhr.send(null);
    * 请求参数 - 添加到URL?key=value
POST请求类型
    * send()方法起作用
    * 在send()方法被调用前,使用setRequestHeader()方法设置请求头信息
    xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
```

Demo:Ajax实现二级联动
<iframe style="width:100%;height:400px;background:#eee" src="http://yueshangmx.top/demo/ajax.html"></iframe>

#### 6.其他实现Ajax的步骤
```
另外的实现Ajax的步骤
   * 创建XMLHttpRequest对象
   * 注册监听
   * 建立连接
   * 发送请求
实现Ajax的六步是什么?(不标准)
   * 创建XMLHttpRequest对象
   * 建立连接
   * 发送请求
   * 注册监听 - onreadystatechange事件
   * 获取服务器端的通信状态 - readyState
   * 获取服务器端的状态码
```

### 3.服务器响应数据的解析以及XML和JSON

使用Ajax异步交互过程中，接收服务器的响应数据时，使用XMLHttpRequest核心对象的responseText属性，只能接收文本(HTML)格式，这种数据在解析过程中比较复杂，容易在拆串或拼串时出错。

#### 1.XML格式

XML文件的扩展名为`.xml`，定义方式与HTML非常相似，但允许自定义元素。目前常用的版本为1.0版本，主要用作配置文件和存储数据。

- HTML、XHTML、DHTML和XML的区别
```
* HTML就是网页 - 元素定义大小写
* XHTML就是严格意义的HTML - 元素定义小写
* DHTML - BOM|DOM
* XML - 配置文件|数据格式
```

- XML语法
```
声明
    <?xml version="1.0" encoding="UTF-8" ?>
        * version - 设置当前XML文件的版本
        * encoding - 设置当前XML文件的编码
        * 注意 - 出现在0行0列上
定义元素
    * 根元素 - 必须是起始标签且只能定义一个
    * 定义子元素 - 元素名可以自定义
```

- DOM解析XML

创建XML的解析器
```
function parseXML(xml){     // 声明解析XML后的DOM对象
    var xmlDoc = null;
    // 根据不同的浏览器
    if(window.DOMParser){   // 其他浏览器
        var parser = new DOMParser();
        xmlDoc = parser.parseFromString(xml,"application/xml");
    }else{                  // IE浏览器
        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = false;
        xmlDoc.loadXML(xml);
    }
    return xmlDoc;
}
```

#### 2.Ajax中的XML格式
```
请求的数据格式 - XML
    客户端如何构建符合XML格式的数据
        * 构建的数据类型 - 字符串(string)类型
        * 字符串的内容符合XML格式的语法要求
    服务器端如何接收符合XML格式的数据
        * 接收客户端的请求数据 - 字符串(string)类型
        * PHP集成了DOM的相关内容
           * DOMDocument类
           * DOMElement类
           * DOMNode类
响应的数据格式 - XML
    服务器端如何构建符合XML格式的数据
        * 设置服务器端的响应头"Content-Type"值为"text/xml"
        * 构建符合XML格式数据内容
            * 手动方式构建字符串(string)内容
            * DOMDocument对象的方法
                * loadXML(符合XML格式的字符串);
                * saveXML()方法进行响应
    客户端如何接收符合XML格式的数据
        * 使用XMLHttpRequest对象的responseXML属性接收
        * 接收回来的就是XML DOM对象(不需要使用XML解析器进行解析)
        * 直接使用DOM解析XML DOM对象即可
```

Demo:Ajax中XML格式的二级联动
<iframe style="width:100%;height:400px;background:#eee" src="http://yueshangmx.top/demo/xml.html"></iframe>

#### 3.JSON格式
